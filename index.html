/* --- PREMIUM STYLES --- */
:root {
    --bg: #ffffff;
    --text: #101828;
    --muted: #667085;
    --card-bg: rgba(255, 255, 255, 0.8);
    --border: rgba(16, 24, 40, 0.08);
    --shadow: 0 18px 40px rgba(16, 24, 40, 0.08);
    --radius: 24px;
    
    /* Pink-Purple-Blue Gradient */
    --grad: linear-gradient(135deg, #ff7bd5 0%, #8b7bff 45%, #55c7ff 100%);
    --grad-hover: linear-gradient(135deg, #ff9de0 0%, #a295ff 45%, #7bd7ff 100%);
    
    --nav-height: 80px;
    --font: 'Poppins', sans-serif;
}

[data-theme="dark"] {
    --bg: #0f1115;
    --text: #ffffff;
    --muted: #94a3b8;
    --card-bg: rgba(30, 30, 40, 0.6);
    --border: rgba(255, 255, 255, 0.1);
    --shadow: 0 18px 40px rgba(0, 0, 0, 0.4);
}

/* RESET */
* { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
html { scroll-behavior: smooth; }
body { margin: 0; padding: 0; font-family: var(--font); background: var(--bg); color: var(--text); overflow-x: hidden; transition: 0.3s; padding-bottom: 80px; }
a { text-decoration: none; color: inherit; transition: 0.3s; }
ul { list-style: none; padding: 0; margin: 0; }
img { max-width: 100%; display: block; object-fit: cover; }

/* UTILS */
.container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
.section { padding: 80px 0; }
.flex { display: flex; align-items: center; }
.bg-light { background: rgba(139,123,255,0.03); }
.hidden-mobile { display: block; }
@media(max-width: 992px) { .hidden-mobile { display: none !important; } }

/* BUTTONS */
.btn {
    display: inline-flex; align-items: center; justify-content: center; gap: 10px;
    padding: 14px 32px; border-radius: 99px; font-weight: 600; font-size: 15px;
    border: none; cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    position: relative; overflow: hidden;
}
.btn-primary { background: var(--text); color: var(--bg); }
.btn-primary:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.15); }
.btn-grad { background: var(--grad); color: white; box-shadow: 0 10px 25px rgba(139, 123, 255, 0.3); }
.btn-grad:hover { transform: translateY(-3px) scale(1.02); box-shadow: 0 15px 35px rgba(139, 123, 255, 0.4); }
.btn-white { background: white; color: var(--text); }
.w-100 { width: 100%; }

/* HEADER */
.announcement-bar { background: var(--text); color: var(--bg); font-size: 12px; padding: 8px 0; text-align: center; font-weight: 500; letter-spacing: 0.5px; }
.announcement-bar .container { display: flex; justify-content: center; gap: 20px; }

.navbar {
    position: sticky; top: 0; z-index: 1000; height: var(--nav-height);
    background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px); border-bottom: 1px solid var(--border);
    transition: 0.3s;
}
.navbar .container { height: 100%; justify-content: space-between; }
.brand { font-size: 26px; font-weight: 800; letter-spacing: -1px; }
.brand span { background: var(--grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

.nav-menu { display: flex; gap: 32px; }
.nav-link { font-weight: 500; font-size: 14px; color: var(--muted); position: relative; }
.nav-link:hover, .nav-link.active { color: var(--text); }
.nav-link.active::after { content:''; position: absolute; bottom: -4px; left: 0; width: 100%; height: 2px; background: var(--grad); border-radius: 2px; }

.nav-icons { display: flex; gap: 16px; }
.icon-btn { width: 44px; height: 44px; border-radius: 50%; border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; background: transparent; color: var(--text); position: relative; }
.icon-btn:hover { background: var(--bg); border-color: transparent; box-shadow: var(--shadow); transform: translateY(-2px); }
.badge { position: absolute; top: -2px; right: -2px; width: 18px; height: 18px; background: var(--grad); border-radius: 50%; color: white; font-size: 10px; font-weight: 700; display: flex; align-items: center; justify-content: center; border: 2px solid var(--bg); }
.hamburger { display: none; font-size: 24px; cursor: pointer; color: var(--text); }
.lang-switch { font-size: 12px; font-weight: 800; cursor: pointer; border: 2px solid var(--border); padding: 4px 8px; border-radius: 6px; }

/* HERO */
.hero { position: relative; padding: 60px 0 100px; overflow: hidden; }
.hero-box {
    background: radial-gradient(circle at top right, rgba(139,123,255,0.1), transparent 40%),
                radial-gradient(circle at bottom left, rgba(255,123,213,0.1), transparent 40%);
    border-radius: 40px; padding: 80px 60px; position: relative; border: 1px solid var(--border);
    display: grid; grid-template-columns: 1fr 1fr; align-items: center; gap: 40px;
}
.hero-content { z-index: 2; animation: fadeUp 1s cubic-bezier(0.2, 0.8, 0.2, 1); }
.hero-tag { background: rgba(139,123,255,0.1); color: #8b7bff; padding: 8px 16px; border-radius: 30px; font-weight: 700; font-size: 12px; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 24px; display: inline-block; }
.hero h1 { font-size: 64px; line-height: 1.1; margin-bottom: 24px; font-weight: 800; letter-spacing: -2px; }
.gradient-text { background: var(--grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.hero p { font-size: 18px; color: var(--muted); margin-bottom: 40px; line-height: 1.6; max-width: 450px; }
.hero-btns { display: flex; align-items: center; gap: 30px; }
.trust-text { font-size: 12px; font-weight: 600; }
.stars { color: #fbbf24; letter-spacing: 2px; }

.hero-img-box { position: relative; z-index: 2; perspective: 1000px; }
.hero-img { width: 100%; border-radius: 32px; box-shadow: 0 30px 60px rgba(0,0,0,0.15); transform: rotateY(-5deg) rotateX(2deg); transition: transform 0.1s ease-out; }
.float-bubble { position: absolute; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); padding: 12px 20px; border-radius: 20px; box-shadow: var(--shadow); display: flex; gap: 12px; align-items: center; animation: float 6s infinite ease-in-out; font-size: 12px; font-weight: 600; color: #333; }
.fb-1 { top: 10%; left: -30px; }
.fb-2 { bottom: 10%; right: -20px; animation-delay: -3s; }
@keyframes fadeUp { from { opacity:0; transform:translateY(30px); } to { opacity:1; transform:translateY(0); } }
@keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-15px)} }

/* MARQUEE */
.trust-strip { padding: 40px 0; border-bottom: 1px solid var(--border); overflow: hidden; }
.marquee { display: flex; gap: 80px; width: max-content; animation: scroll 40s linear infinite; opacity: 0.5; font-weight: 700; font-size: 24px; color: var(--text); }
@keyframes scroll { to { transform: translateX(-50%); } }

/* CATEGORIES */
.section-header { text-align: center; margin-bottom: 50px; max-width: 600px; margin-left: auto; margin-right: auto; }
.section-header h2 { font-size: 36px; margin-bottom: 10px; font-weight: 800; }
.cat-grid { display: grid; grid-template-columns: repeat(12, 1fr); grid-template-rows: 300px 300px; gap: 24px; }
.cat-card { position: relative; border-radius: var(--radius); overflow: hidden; cursor: pointer; border: 1px solid var(--border); }
.cat-card img { width: 100%; height: 100%; object-fit: cover; transition: 0.6s; }
.cat-card:hover img { transform: scale(1.05); }
.cat-info { position: absolute; bottom: 20px; left: 20px; right: 20px; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); padding: 20px; border-radius: 20px; display: flex; justify-content: space-between; align-items: center; }
.cat-info h3 { margin: 0; font-size: 18px; font-weight: 700; color: #101828; }
.arrow-btn { width: 40px; height: 40px; background: var(--text); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; transform: rotate(-45deg); transition: 0.3s; }
.cat-card:hover .arrow-btn { transform: rotate(0); background: var(--grad); }
.c-1 { grid-column: span 6; } .c-2 { grid-column: span 6; } .c-3 { grid-column: span 4; } .c-4 { grid-column: span 4; } .c-5 { grid-column: span 4; }

/* PRODUCTS */
.tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 40px; }
.tab { padding: 10px 24px; border-radius: 50px; background: var(--bg); border: 1px solid var(--border); cursor: pointer; font-weight: 600; transition: 0.3s; }
.tab.active, .tab:hover { background: var(--text); color: var(--bg); border-color: var(--text); }
.toolbar { display: flex; justify-content: space-between; margin-bottom: 30px; flex-wrap: wrap; gap: 15px; }
.search-sm { position: relative; }
.search-sm input { padding: 10px 20px 10px 40px; border-radius: 30px; border: 1px solid var(--border); background: var(--bg); color: var(--text); font-family: var(--font); }
.search-sm i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--muted); }
#gridSort { padding: 10px 20px; border-radius: 30px; border: 1px solid var(--border); background: var(--bg); color: var(--text); font-family: var(--font); cursor: pointer; }

.product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 30px; }
.product-card { background: var(--card-bg); border-radius: var(--radius); overflow: hidden; transition: 0.3s; position: relative; border: 1px solid transparent; box-shadow: var(--shadow-sm); }
.product-card:hover { transform: translateY(-10px); box-shadow: var(--shadow); border-color: rgba(139,123,255,0.3); }
.pc-img-box { height: 320px; position: relative; overflow: hidden; background: #f4f4f4; }
.pc-img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
.product-card:hover .pc-img { transform: scale(1.1); }
.pc-overlay { position: absolute; top: 15px; right: 15px; display: flex; flex-direction: column; gap: 10px; transform: translateX(50px); transition: 0.3s; opacity: 0; }
.product-card:hover .pc-overlay { transform: translateX(0); opacity: 1; }
.pc-btn { width: 40px; height: 40px; border-radius: 50%; background: white; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.1); color: var(--text); transition: 0.2s; border: none; }
.pc-btn:hover { background: var(--text); color: white; }
.pc-info { padding: 20px; }
.pc-title { font-weight: 700; font-size: 16px; margin-bottom: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.pc-price { font-weight: 600; color: var(--muted); }
.pc-price b { color: var(--text); font-size: 18px; margin-right: 5px; }

/* PROMO */
.promo-banner { background: var(--text); border-radius: var(--radius); color: white; display: flex; align-items: center; justify-content: space-between; padding: 60px; position: relative; overflow: hidden; }
.pb-content { z-index: 2; max-width: 500px; }
.pb-content h2 { font-size: 48px; line-height: 1; margin: 20px 0; font-weight: 800; }
.countdown { display: flex; gap: 20px; margin-bottom: 30px; }
.countdown span { font-size: 32px; font-weight: 800; display: block; line-height: 1; background: var(--grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.pb-image img { position: absolute; right: 0; bottom: 0; height: 110%; object-fit: cover; mask-image: linear-gradient(to left, black 60%, transparent); -webkit-mask-image: linear-gradient(to left, black 60%, transparent); }

/* REVIEWS & NEWSLETTER */
.reviews-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
.review-card { background: var(--card-bg); padding: 30px; border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow-sm); }
.user { display: flex; gap: 15px; align-items: center; margin-top: 20px; }
.avatar { width: 45px; height: 45px; background: var(--grad); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; color: white; }
.nl-box { background: var(--grad); padding: 80px 40px; border-radius: var(--radius); text-align: center; color: white; }
.nl-form { display: flex; max-width: 500px; margin: 30px auto 0; background: white; padding: 6px; border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
.nl-form input { flex: 1; border: none; padding: 10px 24px; border-radius: 50px; font-size: 16px; outline: none; }
.nl-form button { padding: 12px 32px; border-radius: 50px; background: var(--text); color: white; font-weight: 600; cursor: pointer; border: none; }

/* FOOTER */
.footer { background: #0f1115; color: #94a3b8; padding: 80px 0 30px 0; margin-top: 50px; }
.footer-grid { display: grid; grid-template-columns: 1.5fr 1fr 1fr 1fr; gap: 40px; }
.footer h4 { color: white; margin-bottom: 24px; font-weight: 700; }
.footer a { display: block; color: #94a3b8; margin-bottom: 12px; transition: 0.2s; }
.footer a:hover { color: white; }
.footer-btm { border-top: 1px solid rgba(255,255,255,0.1); margin-top: 60px; padding-top: 30px; display: flex; justify-content: space-between; font-size: 14px; }
.trust-badges { font-size: 24px; display: flex; gap: 15px; color: white; }

/* MODALS & DRAWERS */
.modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 3000; display: none; align-items: center; justify-content: center; }
.modal-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); }
.modal.active { display: flex; animation: fadeIn 0.3s; }
.modal-content { background: var(--card-bg); width: 90%; max-width: 900px; border-radius: var(--radius); padding: 40px; position: relative; z-index: 2; animation: scaleUp 0.3s; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow); }
@keyframes scaleUp { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.drawer { position: fixed; z-index: 3001; background: var(--bg); transition: 0.4s cubic-bezier(0.77, 0, 0.175, 1); box-shadow: -10px 0 40px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
.drawer-right { top: 0; right: 0; width: 450px; max-width: 90%; height: 100%; transform: translateX(100%); }
.drawer.active { transform: translateX(0); }
.drawer-header { padding: 30px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
.drawer-body { padding: 30px; flex: 1; overflow-y: auto; }
.drawer-footer { padding: 30px; border-top: 1px solid var(--border); background: var(--bg-alt); }

/* FORMS */
.form-input { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--border); background: var(--bg); color: var(--text); margin-bottom: 16px; font-family: var(--font); font-size: 15px; }
.form-input:focus { border-color: #8b7bff; box-shadow: 0 0 0 3px rgba(139,123,255,0.1); }
.pay-opt { flex: 1; padding: 16px; border: 1px solid var(--border); border-radius: 12px; text-align: center; cursor: pointer; font-weight: 600; transition: 0.2s; color: var(--muted); }
.pay-opt.active { border-color: #8b7bff; background: rgba(139,123,255,0.05); color: #8b7bff; }
.copy-box { background: rgba(139,123,255,0.05); padding: 20px; border-radius: 16px; text-align: center; margin-bottom: 24px; cursor: pointer; border: 1px dashed #8b7bff; transition: 0.2s; }
.copy-box:active { background: rgba(139,123,255,0.15); }

/* TOAST */
#toastContainer { position: fixed; top: 30px; right: 30px; z-index: 4000; display: flex; flex-direction: column; gap: 15px; }
.toast { background: var(--text); color: var(--bg); padding: 16px 24px; border-radius: 12px; font-weight: 600; font-size: 14px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); animation: slideIn 0.3s; display: flex; align-items: center; gap: 12px; }
@keyframes slideIn { from { transform: translateX(100%); opacity: 0; } }

/* QUICK VIEW */
.qv-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; }
.qv-img img { width: 100%; border-radius: var(--radius); }
.c-opt { width: 32px; height: 32px; border-radius: 50%; display: inline-block; margin-right: 8px; cursor: pointer; border: 2px solid transparent; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
.c-opt.selected { border-color: var(--text); transform: scale(1.1); }

/* RESPONSIVE */
@media(max-width: 992px) {
    .nav-menu { display: none; }
    .hamburger { display: block; }
    .hero-box { grid-template-columns: 1fr; text-align: center; padding: 40px 20px; }
    .hero h1 { font-size: 42px; }
    .hero-img { transform: none !important; margin-top: 30px; }
    .cat-grid { grid-template-columns: 1fr; grid-template-rows: auto; }
    .c-1, .c-2, .c-3, .c-4, .c-5 { grid-column: span 1; height: 250px; }
    .contact-grid, .footer-grid, .qv-grid { grid-template-columns: 1fr; }
    .pb-image img { display: none; }
    .pb-content { text-align: center; margin: 0 auto; }
    .countdown { justify-content: center; }
}

/* MOBILE MENU */
.mobile-menu { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 2000; padding: 20px; transform: translateX(-100%); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; }
.mobile-menu.open { transform: translateX(0); }
.mm-header { display: flex; justify-content: space-between; margin-bottom: 40px; align-items: center; }
.mm-links { display: flex; flex-direction: column; gap: 24px; font-size: 24px; font-weight: 700; }
.mm-links a { color: var(--text); transition: 0.2s; }
.mm-links a:hover { color: #8b7bff; transform: translateX(10px); }
</style>

    <script>
        // --- DATA & CONFIG ---
        const WA_NUMBER = "994507516137"; 
        const API_URL = "https://script.google.com/macros/s/AKfycbw5TG1rIhVZ_jqZjLy08KiTAC0YqrMc0QXD5Us22E4rpcb3hARRhW6LauxhZhwTpqmSCQ/exec";

        const products = [
            // ƒ∞dman Geyimi
            { id: 101, name: "Nike Tech Fleece", price: 180, cat: "idman_geyim", img: "https://images.unsplash.com/photo-1556905055-8f358a7a47b2?w=500&q=80", tag: "HOT" },
            { id: 102, name: "Adidas Hoodie", price: 120, cat: "idman_geyim", img: "https://images.unsplash.com/photo-1578768079052-aa76e52ff62e?w=500&q=80" },
            { id: 103, name: "Puma Sport Set", price: 95, cat: "idman_geyim", img: "https://images.unsplash.com/photo-1518310383802-640c2de311b2?w=500&q=80" },
            // Ayaqqabƒ±
            { id: 201, name: "Jordan 1 High", price: 350, cat: "idman_ayaqqabi", img: "https://images.unsplash.com/photo-1597045566677-8cf032ed6634?w=500&q=80", tag: "POPULAR" },
            { id: 202, name: "Yeezy Boost", price: 400, cat: "idman_ayaqqabi", img: "https://images.unsplash.com/photo-1587563871167-1ee7c7358bcc?w=500&q=80" },
            { id: 203, name: "New Balance 550", price: 220, cat: "idman_ayaqqabi", img: "https://images.unsplash.com/photo-1551107696-a4b0c5a0d9a2?w=500&q=80" },
            // G√∂z…ôllik
            { id: 301, name: "Chanel Perfume", price: 210, cat: "gozellik", img: "https://images.unsplash.com/photo-1594035910387-fea47794261f?w=500&q=80" },
            { id: 302, name: "Dior Sauvage", price: 190, cat: "gozellik", img: "https://images.unsplash.com/photo-1523293182086-7651a899d60f?w=500&q=80" },
            // B…ôz…ôk
            { id: 401, name: "Silver Necklace", price: 85, cat: "bezek", img: "https://images.unsplash.com/photo-1599643478518-17488fbbcd75?w=500&q=80" },
            { id: 402, name: "Gold Ring", price: 150, cat: "bezek", img: "https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=500&q=80" },
            // Telefon
            { id: 501, name: "iPhone 15 Case", price: 35, cat: "telefon", img: "https://images.unsplash.com/photo-1601593346740-925612772716?w=500&q=80" },
            { id: 502, name: "AirPods Pro 2", price: 450, cat: "telefon", img: "https://images.unsplash.com/photo-1603351154351-5cf99703f6a8?w=500&q=80", tag: "NEW" },
            { id: 503, name: "Apple Watch", price: 650, cat: "telefon", img: "https://images.unsplash.com/photo-1508685586037-3c6b604a5137?w=500&q=80" }
        ];

        let cart = JSON.parse(localStorage.getItem('tb_cart')) || [];
        let wishlist = JSON.parse(localStorage.getItem('tb_wish')) || [];
        let curPay = 'm10';

        // --- INIT ---
        window.onload = () => {
            initTheme();
            renderProducts();
            updateUI();
            startCountdown();
            
            // Hero Parallax
            document.addEventListener('mousemove', (e) => {
                const x = (window.innerWidth - e.pageX) / 50;
                const y = (window.innerHeight - e.pageY) / 50;
                const img = document.querySelector('.hero-img');
                if(img) img.style.transform = `rotateY(${-5 + x/5}deg) rotateX(${2 + y/5}deg)`;
            });

            // Newsletter Popup
            if(!localStorage.getItem('nl_shown') && window.scrollY < 100) {
                setTimeout(() => openModal('nlPopup'), 5000);
                localStorage.setItem('nl_shown', 'true');
            }
        };

        // --- CORE FUNCTIONS ---
        function renderProducts(filter = 'all') {
            const grid = document.getElementById('productGrid');
            const search = document.getElementById('gridSearch').value.toLowerCase();
            const sort = document.getElementById('gridSort').value;

            let list = products.filter(p => p.name.toLowerCase().includes(search));
            
            if(filter !== 'all' && filter !== 'new' && filter !== 'popular') {
                list = list.filter(p => p.cat === filter);
            }
            if(filter === 'new') list = list.filter(p => p.tag === 'NEW');
            if(filter === 'popular') list = list.filter(p => p.tag === 'POPULAR');

            if(sort === 'price-asc') list.sort((a,b) => a.price - b.price);
            if(sort === 'price-desc') list.sort((a,b) => b.price - a.price);
            if(sort === 'rating') list.sort((a,b) => b.price - a.price); // Mock rating sort

            if(list.length === 0) { grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:40px;color:var(--muted);">N…ôtic…ô tapƒ±lmadƒ±</div>`; return; }

            grid.innerHTML = list.map(p => `
                <div class="product-card">
                    <div class="pc-img-box">
                        <img src="${p.img}" class="pc-img" loading="lazy">
                        ${p.tag ? `<div class="pc-badges"><span class="tag ${p.tag.toLowerCase()}">${p.tag}</span></div>` : ''}
                        <div class="pc-overlay">
                            <button class="pc-btn" onclick="addToWish(${p.id})"><i class="fa-regular fa-heart"></i></button>
                            <button class="pc-btn" onclick="openQuickView(${p.id})"><i class="fa-regular fa-eye"></i></button>
                        </div>
                    </div>
                    <div class="pc-info">
                        <div class="pc-title">${p.name}</div>
                        <div class="pc-price"><b>${p.price} ‚Çº</b></div>
                        <button class="pc-add" onclick="addToCart(${p.id})">S…ôb…ôt…ô At</button>
                    </div>
                </div>
            `).join('');
        }

        function filterCat(cat) {
            document.getElementById('trending').scrollIntoView();
            renderProducts(cat);
        }

        function setTab(type, el) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            renderProducts(type);
        }

        // --- CART ---
        function addToCart(id) {
            const p = products.find(i => i.id === id);
            const exist = cart.find(i => i.id === id);
            if(exist) exist.qty++;
            else cart.push({...p, qty: 1});
            saveState(); updateUI();
            showToast(`${p.name} s…ôb…ôt…ô …ôlav…ô olundu`);
            openDrawer('cart');
        }

        function removeFromCart(id) {
            cart = cart.filter(i => i.id !== id);
            saveState(); updateUI();
        }

        function changeQty(id, delta) {
            const item = cart.find(i => i.id === id);
            if(item) {
                item.qty += delta;
                if(item.qty <= 0) removeFromCart(id);
                else { saveState(); updateUI(); }
            }
        }

        function saveState() {
            localStorage.setItem('tb_cart', JSON.stringify(cart));
            localStorage.setItem('tb_wish', JSON.stringify(wishlist));
        }

        function updateUI() {
            document.getElementById('cartCount').innerText = cart.reduce((a,b)=>a+b.qty,0);
            document.getElementById('dCartCount').innerText = cart.length;
            document.getElementById('wishCount').innerText = wishlist.length;
            
            const total = cart.reduce((a,b) => a + (b.price*b.qty), 0);
            document.getElementById('dCartTotal').innerText = total + " ‚Çº";
            
            // Render Cart Drawer
            const cartDiv = document.getElementById('cartItems');
            if(cart.length === 0) cartDiv.innerHTML = '<div style="text-align:center; padding:40px; color:var(--muted);">S…ôb…ôt bo≈üdur</div>';
            else {
                cartDiv.innerHTML = cart.map(i => `
                    <div style="display:flex; gap:15px; margin-bottom:20px; align-items:center;">
                        <img src="${i.img}" style="width:60px; height:60px; border-radius:10px; object-fit:cover;">
                        <div style="flex:1;">
                            <div style="font-weight:600; font-size:14px;">${i.name}</div>
                            <div style="font-size:13px; opacity:0.7;">${i.price} ‚Çº</div>
                        </div>
                        <div style="display:flex;align-items:center;gap:10px;">
                            <button onclick="changeQty(${i.id}, -1)" style="width:24px;height:24px;border:1px solid #ddd;background:none;cursor:pointer;">-</button>
                            <span>${i.qty}</span>
                            <button onclick="changeQty(${i.id}, 1)" style="width:24px;height:24px;border:1px solid #ddd;background:none;cursor:pointer;">+</button>
                        </div>
                        <i class="fa-solid fa-trash" style="color:red; cursor:pointer; margin-left:10px;" onclick="removeFromCart(${i.id})"></i>
                    </div>
                `).join('');
            }

            // Render Wishlist
            const wishDiv = document.getElementById('wishlistItems');
            if(wishlist.length === 0) wishDiv.innerHTML = '<div style="text-align:center; padding:40px; color:var(--muted);">Bo≈üdur</div>';
            else {
                wishDiv.innerHTML = wishlist.map(i => `
                    <div style="display:flex; gap:15px; margin-bottom:20px; align-items:center;">
                        <img src="${i.img}" style="width:50px; height:50px; border-radius:10px; object-fit:cover;">
                        <div style="flex:1;">
                            <div style="font-weight:600; font-size:13px;">${i.name}</div>
                            <div style="font-size:12px; color:var(--muted);">${i.price} ‚Çº</div>
                        </div>
                        <button onclick="addToCart(${i.id})" class="btn-primary" style="padding:6px 12px; border-radius:20px; font-size:12px; border:none; cursor:pointer;">Al</button>
                    </div>
                `).join('');
            }
        }

        function addToWish(id) {
            const p = products.find(i => i.id === id);
            if(!wishlist.find(i => i.id === id)) {
                wishlist.push(p);
                saveState(); updateUI();
                showToast("Favoritl…ôr…ô …ôlav…ô olundu");
            } else {
                showToast("Artƒ±q favoritl…ôrd…ôdir", "info");
            }
        }

        // --- DRAWER & MODAL ---
        function openDrawer(type) {
            document.getElementById('overlay').classList.add('active');
            if(type === 'cart') document.getElementById('cartDrawer').classList.add('active');
            if(type === 'wishlist') document.getElementById('wishlistDrawer').classList.add('active');
        }

        function openModal(id) {
            document.getElementById('overlay').classList.add('active');
            document.getElementById(id).classList.add('active');
        }

        function closeAll() {
            document.getElementById('overlay').classList.remove('active');
            document.querySelectorAll('.drawer').forEach(d => d.classList.remove('active'));
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
        }
        function closeNl() { document.getElementById('nlPopup').classList.remove('active'); } // Overlay qalirsa manual bagla

        // --- QUICK VIEW ---
        function openQuickView(id) {
            const p = products.find(i => i.id === id);
            document.getElementById('qvImage').src = p.img;
            document.getElementById('qvTitle').innerText = p.name;
            document.getElementById('qvPrice').innerText = p.price + " ‚Çº";
            document.getElementById('qvTag').innerText = p.tag || "SALE";
            document.getElementById('qvAddBtn').onclick = () => { addToCart(p.id); closeAll(); };
            openModal('quickViewModal');
        }

        // --- CHECKOUT ---
        function openCheckout() {
            if(cart.length === 0) return alert("S…ôb…ôt bo≈üdur");
            closeAll();
            document.getElementById('checkoutTotal').innerText = document.getElementById('dCartTotal').innerText;
            openModal('checkoutModal');
        }

        function selPay(method, el) {
            curPay = method;
            document.querySelectorAll('.pay-opt').forEach(d => d.classList.remove('active'));
            el.classList.add('active');

            const dest = document.getElementById('payVal');
            const warn = document.getElementById('usdtWarn');
            warn.style.display = 'none';

            if(method === 'm10') dest.innerText = "994507516137";
            if(method === 'card') dest.innerText = "5522099362395972";
            if(method === 'crypto') { dest.innerText = "TLkfDmnsJNz3oQXKCuXyxFmeNde9AvapHJ"; warn.style.display = 'block'; }
        }

        function copyText(txt) {
            navigator.clipboard.writeText(txt).then(() => showToast("Kopyalandƒ±!"));
        }

        document.getElementById('checkoutForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('finishBtn');
            btn.innerHTML = "G√ñND∆èRƒ∞Lƒ∞R... <i class='fa-solid fa-spinner fa-spin'></i>";
            btn.disabled = true;

            const name = document.querySelector('[name="name"]').value;
            const items = cart.map(i => `${i.name} (${i.qty})`).join(', ');
            const total = cart.reduce((a,b) => a+(b.price*b.qty), 0);

            // 1. Send to Sheets
            try {
                await fetch(`${API_URL}?customer=${name}&products=${items}&total=${total}&method=${curPay}`, {mode:'no-cors'});
            } catch(err) { console.log(err); }

            // 2. Send to WhatsApp
            let msg = `üì¶ *Sƒ∞FARƒ∞≈û (TrendBox)*\nüë§ ${name}\nüõí ${items}\nüí∞ ${total} AZN\nüí≥ ${curPay.toUpperCase()}`;
            window.open(`https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(msg)}`, '_blank');

            // Reset
            cart = []; saveState(); updateUI(); closeAll();
            btn.innerText = "√ñD∆èNƒ∞≈û ETDƒ∞M & Bƒ∞Tƒ∞R";
            btn.disabled = false;
            showToast("Sifari≈ü uƒüurla tamamlandƒ±!");
        });

        // --- EXTRAS ---
        function toggleTheme() {
            const html = document.documentElement;
            const cur = html.getAttribute('data-theme');
            html.setAttribute('data-theme', cur === 'light' ? 'dark' : 'light');
            document.getElementById('themeIcon').className = cur === 'light' ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
        }
        function initTheme() {
            // Optional: load from localStorage
        }
        function toggleMobileMenu() {
            document.querySelector('.mobile-menu').classList.toggle('open');
            document.querySelector('.mobile-menu-overlay').classList.toggle('open');
        }
        function startCountdown() {
            let duration = 86400; 
            setInterval(() => {
                duration--;
                const h = Math.floor(duration / 3600);
                const m = Math.floor((duration % 3600) / 60);
                const s = duration % 60;
                document.getElementById('d').innerText = "00";
                document.getElementById('h').innerText = h < 10 ? '0'+h : h;
                document.getElementById('m').innerText = m < 10 ? '0'+m : m;
                document.getElementById('s').innerText = s < 10 ? '0'+s : s;
            }, 1000);
        }
        function showToast(msg, type='success') {
            const cont = document.getElementById('toastContainer');
            const el = document.createElement('div');
            el.className = 'toast';
            el.innerHTML = `<i class="fa-solid ${type==='success'?'fa-check-circle':'fa-info-circle'}" style="color:${type==='success'?'#4ade80':'#60a5fa'}"></i> <span>${msg}</span>`;
            cont.appendChild(el);
            setTimeout(() => { el.style.opacity=1; el.style.transform='translateX(0)'; }, 10);
            setTimeout(() => { el.style.opacity=0; setTimeout(()=>el.remove(), 300); }, 3000);
        }
        
        // Search Modal
        function openSearch() { openModal('searchModal'); document.getElementById('globalSearch').focus(); }
        function handleGlobalSearch() {
            const q = document.getElementById('globalSearch').value.toLowerCase();
            const res = document.getElementById('searchResults');
            if(q.length < 2) { res.innerHTML=''; return; }
            const hits = products.filter(p => p.name.toLowerCase().includes(q));
            res.innerHTML = hits.map(p => `
                <div onclick="openQuickView(${p.id});closeAll()" style="display:flex;gap:10px;padding:10px;border-bottom:1px solid var(--border);cursor:pointer;">
                    <img src="${p.img}" style="width:40px;height:40px;object-fit:cover;border-radius:6px;">
                    <div><div style="font-weight:600;font-size:14px;">${p.name}</div><div style="font-size:12px;color:var(--muted);">${p.price} ‚Çº</div></div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
